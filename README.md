# <img src="https://github.com/nbcamp-HappyMoney/HappyMoney/blob/dev/assets/images/favicon.png"  width="30" height="30"/> HappyMoney


#### 당신에게 1억이 주어진다면?

<br>

#### 🏠 배포 주소 : [HappyMoney](https://happymoneynow.com/views/main.html)
#### 📊 작업 로그 : [Notion](https://www.notion.so/a7ef569785744b1099a268f691db41ff?pvs=4)
#### 📌 브로 슈어 : [Brochure](https://www.notion.so/A-3-HAPPY-MONEY-84c6ffd6f0cc49768bd7f4f1fadf50dc?pvs=4)
#### 🏆 수상 내역
![내배캠최우수상 - Happy Money](https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/05d851ef-fde5-430e-8c4e-ee2964945d23)

-------------------

<br>

# 📝 소개

* **프로젝트명** : HappyMoney
* **기간** : 2024년 1월 12일 ~ 2024년 2월 20일
* **주제** : 가상 포인트를 사용하여 부담없이 시도해볼 수 있는 모의 투자 서비스 & 의견을 교류하고 소통이 가능한 커뮤니티 서비스
* **주요기능** 
  1. 실시간 호가 데이터를 바탕으로한 주식 주문 기능
  2. 모의투자 결과를 바탕으로한 랭킹 기능 
  3. 대기 주문체결, 댓글, 쪽지 수신 시 웹 푸시 알림 기능
<br>

# 👨‍👩‍👧‍👦Team Members

| Position      | Name          |    Github                                            | Tech Blog                               |
|:--------------|:--------------|:-----------------------------------------------------|-----------------------------------------|
| Backend       | 문준식        | [Geniusjun6](https://github.com/Geniusjun6)           |https://geniusjun6.tistory.com/          |
| Backend       | 임재진        | [LIM-JAE-JIN](https://github.com/LIM-JAE-JIN)         |https://wowls9416.tistory.com/           |
| Backend       | 이상권        | [sangkwonlee1722](https://github.com/sangkwonlee1722) |https://github.com/sangkwonlee1722       |
| Backend       | 김주완        | [nugabah](https://github.com/nugabah)                 |https://columen2357.tistory.com/         |
| Backend       | 김민재        | [kimminjae981002](https://github.com/kimminjae981002) |https://velog.io/@minjae98/posts         |

<br>

# 📹 주요 기능 사진
<details>
<summary> #1 실시간 호가 데이터를 바탕으로한 주식 주문 기능 </summary>
<div markdown="1">



![실시간호가](https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/99943d1d-d00c-47b7-b877-37b4a7bb7e1d)
![실시간호가사진](https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/6449d5f6-4d18-4feb-a1ac-08e2020734da)


</div>
</details>

<details>
<summary> #2 모의투자 결과를 바탕으로한 랭킹 기능  </summary>
<div markdown="1">



![랭킹1](https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/80caed7f-c183-4774-a9ab-0c1989148a10)
![랭킹2](https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/2753298e-8eb5-4994-9778-1d7ce8139e9a)

</div>
</details>

<details>
<summary> #3 대기 주문체결, 댓글, 쪽지 수신 시 웹 푸시 알림 기능 </summary>
<div markdown="1">



![웹푸쉬알림](https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/4a1e7a82-50c1-4684-833e-d49b339218c5)
![웹푸시1](https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/5cf1b258-22da-4660-a515-5bad011f836f)


</div>
</details>

<details>
<summary> #4 커뮤니티 </summary>
<div markdown="1">



![커뮤니티1](https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/3dc01791-d561-4cc6-8a2f-365253db725d)
![커뮤니티2](https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/5752ff69-49f4-4900-b63c-99fb85d7e1c6)
![커뮤니티3](https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/0a0b0e39-cb60-4b5b-8b28-624b871d4985)


</div>
</details>
<br>

# ⚒ 기술 스택

<br>

<h3 tabindex="-1" dir="auto"><a id="user-content--frond-end" class="anchor" aria-hidden="true" href="#-frond-end"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><g-emoji class="g-emoji" alias="heavy_check_mark" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png">✔</g-emoji> Front-end</h3>
<div dir="auto">
<img src="https://img.shields.io/badge/HTML5-E34F26?style=for-the-badge&logo=HTML5&logoColor=white">
<img src="https://img.shields.io/badge/CSS3-1572B6?style=for-the-badge&logo=CSS3&logoColor=white">
<img src="https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=JavaScript&logoColor=white">
<img src="https://img.shields.io/badge/jQuery-0769AD?style=for-the-badge&logo=jQuery&logoColor=white">
<img src="https://img.shields.io/badge/Bootstrap-7952B3?style=for-the-badge&logo=Bootstrap&logoColor=white">
<img src="https://img.shields.io/badge/Axios-5A29E4?style=for-the-badge&logo=Axios&logoColor=white">
</div>
<h3 tabindex="-1" dir="auto"><a id="user-content--back-end" class="anchor" aria-hidden="true" href="#-back-end"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><g-emoji class="g-emoji" alias="heavy_check_mark" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png">✔</g-emoji> Back-end</h3>
<div dir="auto">
<img src="https://img.shields.io/badge/Node.js-339933?style=for-the-badge&logo=Node.js&logoColor=white">
<img src="https://img.shields.io/badge/NestJS-E0234E?style=for-the-badge&logo=NestJS&logoColor=white">
<img src="https://img.shields.io/badge/Typeorm-262627?style=for-the-badge&logo=Typeorm&logoColor=white">
<img src="https://img.shields.io/badge/TypeScript-3178C6?style=for-the-badge&logo=TypeScript&logoColor=white">
<img src="https://img.shields.io/badge/Web Socket-010101?style=for-the-badge&logo=socketdotio&logoColor=white">
<img src="https://img.shields.io/badge/Passport-34E27A?style=for-the-badge&logo=Passport&logoColor=white">
<img src="https://img.shields.io/badge/Web push-5928C6?style=for-the-badge&logo=Web push&logoColor=white">
<img src="https://img.shields.io/badge/JWT-000000?style=for-the-badge&logo=jsonwebtokens&logoColor=white">  
<img src="https://img.shields.io/badge/dotenv-ECD53F?style=for-the-badge&logo=dotenv&logoColor=white">  
<img src="https://img.shields.io/badge/nodemailer-6378C6?style=for-the-badge&logo=nodemailer&logoColor=white">    
<img src="https://img.shields.io/badge/bull-E0576E?style=for-the-badge&logo=bull&logoColor=white">      
</div>
<h3 tabindex="-1" dir="auto"><a id="user-content--back-end" class="anchor" aria-hidden="true" href="#-back-end"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><g-emoji class="g-emoji" alias="heavy_check_mark" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png">✔</g-emoji> CI/CD </h3>
<div dir="auto">
<img src="https://img.shields.io/badge/github%20actions-%232671E5.svg?style=for-the-badge&logo=githubactions&logoColor=white">
  </div>
<h3 tabindex="-1" dir="auto"><a id="user-content--back-end" class="anchor" aria-hidden="true" href="#-back-end"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><g-emoji class="g-emoji" alias="heavy_check_mark" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png">✔</g-emoji> 스크래핑 툴</h3>
<div dir="auto">
<img src="https://img.shields.io/badge/puppeteer-40B5A4?style=for-the-badge&logo=puppeteer&logoColor=white">  
<img src="https://img.shields.io/badge/cheerio-008DB6?style=for-the-badge&logo=cheerio&logoColor=white">
 </div>
<h3 tabindex="-1" dir="auto"><a id="user-content--back-end" class="anchor" aria-hidden="true" href="#-back-end"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><g-emoji class="g-emoji" alias="heavy_check_mark" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png">✔</g-emoji> Database</h3>
<div dir="auto">
<img src="https://img.shields.io/badge/MySQL-4479A1?style=for-the-badge&logo=MySQL&logoColor=white">
<img src="https://img.shields.io/badge/Redis-DC382D?style=for-the-badge&logo=Redis&logoColor=white">
<img src="https://img.shields.io/badge/queue-E0576E?style=for-the-badge&logo=queue&logoColor=white">
</div>
<h3 tabindex="-1" dir="auto"><a id="user-content--dev-tools" class="anchor" aria-hidden="true" href="#-dev-tools"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><g-emoji class="g-emoji" alias="heavy_check_mark" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png">✔</g-emoji> DevOps</h3>
<div dir="auto">
<img src="https://img.shields.io/badge/aws ec2-FF9900?style=for-the-badge&logo=amazonec2&logoColor=white">
<img src="https://img.shields.io/badge/aws rds-527FFF?style=for-the-badge&logo=amazonrds&logoColor=white">  
<img src="https://img.shields.io/badge/aws cloudwatch-FF4F8B?style=for-the-badge&logo=amazoncloudwatch&logoColor=white">
<img src="https://img.shields.io/badge/AWS ElastiCache-CC9900?style=for-the-badge&logo=AWS ElastiCache&logoColor=white">
<img src="https://img.shields.io/badge/aws s3-569A31?style=for-the-badge&logo=amazons3&logoColor=white">
<img src="https://img.shields.io/badge/aws CodeDeploy-FF4F8B?style=for-the-badge&logo=CodeDeploy&logoColor=white">
<img src="https://img.shields.io/badge/aws simpleemailservice-DD344C?style=for-the-badge&logo=amazonsimpleemailservice&logoColor=white">
<img src="https://img.shields.io/badge/aws route53-8C4FFF?style=for-the-badge&logo=amazonroute53&logoColor=white">
<img src="https://img.shields.io/badge/aws lambda-FF9900?style=for-the-badge&logo=awslambda&logoColor=white">
<img src="https://img.shields.io/badge/aws load balancer-AA9900?style=for-the-badge&logo=awsloadbalancer&logoColor=white">  
</div>
<h3 tabindex="-1" dir="auto"><a id="user-content--dev-tools" class="anchor" aria-hidden="true" href="#-dev-tools"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><g-emoji class="g-emoji" alias="heavy_check_mark" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png">✔</g-emoji> 협업툴</h3>
<div dir="auto">
<img src="https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=Git&logoColor=white">
<img src="https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=GitHub&logoColor=white">
<img src="https://img.shields.io/badge/Slack-4A154B?style=for-the-badge&logo=Slack&logoColor=white">
<img src="https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=Notion&logoColor=white">
</div>
</br>
<br>

# 🕸 서비스 아키텍처

![아키텍처](https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/e86a7cdd-351f-45ba-b3b8-bee53939a519)

<br>

#  📒 ERD

https://dbdiagram.io/d/Final_Project_HappyMoney-658a371b89dea6279988f566

<br>

#  📗 와이어 프레임

https://www.figma.com/file/g1xNcU7RORoY56gcK8QJnz/Final_Project_Happy_Money?type=design&node-id=0-1&mode=design

<br>

#  📘 API 명세서(SWAGGER)

https://happymoneynow.com/api-docs 

<br>

# 💣 트러블 슈팅

<details>
<summary>#1 한국투자 OpenAPI 호출 한계</summary>
<br>
<details>
<summary>1) 배경</summary>

- 실시간 호가 데이터는 한국 투자 Open API 사용 중
    - **제한 사항 1**
        - 주식 코드로 요청 후 다른 주식 코드로 요청 시 중복 되어 한국 투자OpenAPI에서 응답 
        ex) **005930을 보내고 006800을 보내면 둘 다 응답 데이터가 전달** 됨
    - **제한 사항 2**
        - 중복된 코드가 20개 이상이 되면 OpenAPI에서 오는 응답 속도가 현저히 느려짐
        - 중복된 코드가 40개 초과 시 한국 투자 OpenAPI에서 연결이 차단됨
</details>

<details>
<summary>2) 해결 방안</summary>

- **1. 해당 주식 코드의 응답만 클라이언트에게 전달**
    - **내용**
        - 서버에서 한국 투자 OpenAPI에서 온 응답 데이터를 해당 주식 코드와 같은 데이터만 클라이언트에 보내주게 작업
    - **구현 코드**
        
        ```tsx
        // server
        
        // 메시지 수신 이벤트 핸들러
        this.wsClient.on("message", async (data) => {
          const messageString = data.toString(); // Buffer를 문자열로 변환
          const jsonData = this.stockhoka(messageString);
          const addCode = jsonData.mksc_shrn_iscd.split("|")[3];
          try {
        
        		// 응답 받은 데이터의 주식 코드와 클라이언트에서 보낸 주식 코드 비교
            if (addCode === tr_key) {
              this.server.emit(`asking_price_${tr_key}`, jsonData);
            }
          } catch (error) {
            console.error("Error parsing JSON:", error);
          }
        });
        ```
        
- **2. 응답을 보내는 주식 코드가 20개 초과 시 WebSocket 재 연결**
    - **내용**
        - 클라이언트에서 보낸 주식 코드를 배열에 담아 체크하여 20개 초과 시 한국 투자 OpenAPI의 재 연결
            - 비 동기 적으로 처리 될 때, 서버가 연결되기 전 데이터를 받아 연결이 제대로 이루어지지 않아 new Promise로 동기적으로 수행
            - 재 연결 후 기존에 실시간 호가를 보고 있던 클라이언트들의 데이터가 재 연결한 클라이언트의 해당 주식의 실시간 호가로 바뀌기 때문에 refresh 이벤트 처리로 클라이언트에서 리다이렉트 처리
    - **구현 코드**
        
        ```tsx
        // stock.gateway.ts
        private addStock: string[] = [];
        
        private async initializeWebSocketClient() {
          if (!this.wsClient) {
            try {
              const url = "ws://ops.koreainvestment.com:21000/tryitout/H0STASP0";
              this.wsClient = new WebSocket(url);
              await new Promise((resolve, reject) => {
                this.wsClient.on("open", () => {
                  console.log("WebSocket connected");
                  resolve(true);
                });
                this.wsClient.on("error", (err) => {
                  console.error("WebSocket error:", err);
                  reject(err);
                });
              });
            } catch (error) {
              console.log("Failed to initialize WebSocket:", error);
            }
          }
        }
        
        // 실시간 호가API
          @SubscribeMessage("asking_price")
          async getAskingPrice(@MessageBody() tr_key: string) {
        		// 중복되지 않은 주식 코드 배열에 추가
            if (!this.addStock.includes(tr_key)) {
              this.addStock.push(tr_key); // addCode 추가
            }
        		// 주식 코드 20개 초과 시 연결 끊고
            if (this.addStock.length > 20) {
              await new Promise((resolve) => {
                this.wsClient.on("close", () => {
                  console.log("WebSocket disconnected.");
                  resolve(true);
                });
                this.wsClient.terminate();
              });
              this.wsClient = null;
              this.addStock = [];
        
        			// 연결 끊었을 때, 클라이언트에 refresh 이벤트 보내기
              this.server.emit("refresh", {});
            }
        		// 웹소켓 다시 연결
            await this.initializeWebSocketClient();
        		
        		// 그 외 로직......
        }
        ```
        
        ```tsx
        // stock-detail.js
        
        function livePriceData() {
          // 여기에서 새로운 WebSocket 연결을 생성하고 반환
          const socket = io('/ws/stock', {
            transports: ['websocket'],
          });
        
          // 연결 성공 시 동작
          socket.on('connect', () => {
        
            // 메시지 전송
            socket.emit('asking_price', trKey);
          });
        
        	// 3초 뒤 기존 클라이언트가 보고 있는 페이지 새로고침
          socket.on('refresh', function () {
            setTimeout(function () {
              alert('실시간 호가 데이터가 수정되었습니다.');
              location.reload();
            }, 3000);
          });
        	
        	// 그 외 로직......
        }
        ```

</details>
</details>
<br>
<details>
<summary> #2 서버 이상 징후 파악을 위한 모니터링 시스템 구축 </summary>
<img src="https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/bb10e9fb-0d30-4799-9ee0-b9a2b4a84859">
<br>
<details>
<summary>1) 배경</summary>

- 특정 요인(서버 과부하, 잘못된 코드 설계)으로 인한 서버 다운 시 모니터링 시스템 구축 필요
    
</details>

<details>
<summary>2) 해결 방안</summary>
  
- **1. Internal Server Error 발생 시 Nest Filter를 이용한 슬랙 알림**
    
    ![Internal Server Error](https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/7c904f12-a840-4724-a834-46b640b1a682)
    
    - **내용**
        - 코드 상 유효성 처리가 아닌 서버 에러 발생 시 별도로 슬랙 알림을 받아 에러를 파악
            - Filter를 사용하여 500번대 에러를 별도로 처리
    
    - **장점**
        - 서버 내부에서 일어난 에러 스택을 함께 확인하여 빠르게 원인 파악 가능
        - 개발중에 발생한 에러의 경우도 빠르게 확인 가능
    
    - **단점**
        - 서버가 Shut-Down이 되었을 경우는 슬랙 알림을 받을 수 없음
        
- **2. AWS Cloud Watch를 사용한 서버 모니터링 시스템 구축**
    
    ![AWS Cloud Watch](https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/510c2199-f16b-4785-b6eb-7ff25c003bdc)
    
    - **내용**
        - 서버 상태에 대한 모니터링 지표 및 임계점을 설정하여 경보 수신
            - EC2 CPU 사용량 60% 이상일 경우
            - 로드밸런서의 헬스 체크가 1번 이상 실패할 경우
            - EC2 메모리 사용량이 60% 이상일 경우
    
    - **장점**
        - 서버 내부가 아닌 외부 서비스를 이용하여 서버 Shut-Down 시에도 확인할 수 있음
        - AWS의 여러 서비스들을 지표화하여 모니터링이 가능함
            - Elastic Cache, S3, RDS 등과 연결하여 다양한 지표 확인 가능
            - 문제를 사전에 예방할 수 있음
    
    - **단점**
        - 사용량에 따른 요금 부과
            - 지표, 경보, 대시보드, 로그 등에 따라 비용 발생
        - AWS Cloud에 대한 이해도 필요

</details>

</details>
<br>
<details>
<summary> #3 주식 주문에 대한 동시성 처리 </summary>
<img src="https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/fe0effdb-58f2-4d3e-9f70-4ff9d1812623">
<br>
<details>
<summary>1) 배경</summary>

- 동시간대에 많은 주문이 들어올 경우 순차적으로 주문을 처리 필요
    - 기본적인 주식 주문 처리 원칙은 먼저 들어온 순서대로 처리 진행
</details>
<details>
<summary>2) 해결 방안</summary>

- **1. Nest.js Bull 라이브러리를 활용하여 비동기 분산 처리**
    - **내용**
        - 주문이 들어올 경우 redis 큐에 넣어 순차적으로 처리
        - 주문 처리의 부하를 분산 및 시스템의 안정성을 높이게 됨
    - **구현 코드**
        
        ```tsx
        // order.service.ts
        
        // 구매(매수)API
          async buyStock({ id }: User, { stockName, stockCode, orderNumbers, price, status }: CreateOrderDto) {
        		......
            try {
              // 주문 데이터를 Redis 큐에 추가
              await this.ordersQueue.add(
                "buy",
                { buyOrder, id },
                {
                  priority: 1, // 우선순위 설정
                  attempts: 3, // 주문 처리가 실패했을 때 최대 3번까지 재시도
                  backoff: 1000, // 재시도 간의 지연 시간
                  removeOnComplete: true, // 주문이 성공적으로 처리되면 큐에서 제거
                  jobId: `${buyOrder.userId}-${buyOrder.stockCode}-${buyOrder.buySell}-${Date.now()}` // 주문 ID를 설정
                }
              );
            } catch (error) {
              console.error(error);
              throw error;
            }
          }
        ```
    
</details>
</details>
<br>
<details>
<summary> #4 DB 보안성 향상을 위한 VPC Private Subnet 구축 </summary>
<img src="https://github.com/nbcamp-HappyMoney/HappyMoney/assets/147799382/05769cba-b6f7-4c13-a058-cf637bfe5f42">
<br>
<details>
<summary>1) 배경</summary>
- 유저의 회원 정보, 주식 거래 정보 등은 민감한 정보로 판단하여 보안성 강화 필요
  
</details>
<details>
<summary>2) 해결 방안</summary>

- **1. DB 내 민감 데이터 암호화**
    - **내용**
        - 민감한 정보로 판단되는 모든 데이터에 암호화를 적용한다.
            - 유저 전화번호, 주식 거래내역, 보유 주식 수 등
    
    - **장점**
        - 데이터를 탈취당하더라도 우리가 선정한 민감 정보는 암호화되어있어 상대적으로 안전
    
    - **단점**
        - 현재 기준 시간적인 여유가 많지 않은 상황에서 전체적으로 코드를 수정하는 것에 대한 리스크
    
- **2. VPC Private Subnet 설정**
    - **내용**
        - VPC 내 Private Subnet을 설정하여 데이터베이스(RDS)는 EC2를 통해서만 접근 허용
        
    - **장점**
        - 외부 접근 경로를 원천적으로 막아 외부의 공격을 방지
    
    - **단점**
        - VPC 내에서 별도의 Private Subnet 추가 구성 및 관리 작업으로 인한 관리 복잡성 우려
        - 외부 접근이 불가하기에 DB관련 외부 서비스 접근 불가 (DBeaver 등)
    
    - **선정 이유**
        - 데이터 암호화 대비 투입되는 리소스가 상대적으로 적다고 판단함
            - 현재 코드 그대로 외부의 서비스를 이용하기 때문
        - 외부의 접근을 아예 막는 방식으로 탈취에 대한 우려를 상대적으로 적게 가져감
        - 1차 작업을 VPC를 통해 보안성을 향상하고 추후 1번 방안을 추가하는 것으로 방향성 결정 !
</details>

</details>


<br>

# ⚙ Github Rules
<details>   
<summary> Branch Convention </summary>
    
* 브랜치명 : 자원/기능
* user/sign-up
* account/read
 
</details>

<details>
<summary> Commit Convention </summary>
<div markdown="1">  

 * Commit Type
```
Feat        : 기능 (새로운 기능)  
Fix         : 버그 (버그 수정)  
Refactor    : 리팩토링  
Design      : CSS 등 사용자 UI 디자인 변경  
Comment     : 필요한 주석 추가 및 변경  
Style       : 스타일 (코드 형식, 세미콜론 추가: 비즈니스 로직에 변경 없음)  
Test        : 테스트 (테스트 코드 추가, 수정, 삭제: 비즈니스 로직에 변경 없음)  
Chore       : 기타 변경사항 (빌드 스크립트 수정, assets, 패키지 매니저 등)  
Init        : 초기 생성  
Rename      : 파일 혹은 폴더명을 수정하거나 옮기는 작업만 한 경우  
Remove      : 파일을 삭제하는 작업만 수행한 경우 
```
* 예시
```
Feat: [performance/read] 모든 공연 조회 API 추가
1) 테스트 REST Client로 변경
- 토큰값 자동으로 할당 가능
- 다른 서비스 사용하지 않고 VS code 에서 처리 가능
```
</div>
</details>

<details>   
<summary> Git Convention(PR) </summary>
  
* Title : (브랜치명) 진행 사항 1줄 요약
  * (reservation/delete) 예약 삭제 API 추가
* 본문 
  * Issue 연결 
  * 진행사항
    * 진행했던 사항을 상세하게 기록
  * 특이사항
    * 오류 발생
    * 다른 사람 코드와 연계되어 영향을 받을 경우 멘션
* 예시
```
#20

진행사항
1) 트랜잭션 처리
* 예약 취소 시 예약 테이블 softDelete 처리 및 status값을 Canceled로 변경
* 예약 취소 시 User 테이블 point 값을 totalPrice 만큼 추가(환불)
* 예약 취소 시 Seat 테이블 status 값을 Possible로 변경 및 reservationId Null 값으로 변경

2) 공연 시작 시간 기준 3시간 전에는 예약 취소 불가
* 혹시 몰라 한국시간으로 변환 후 현재와 비교하여 3시간 미만 일 경우 에러 처리

특이사항
1) 트랜잭션 처리 중 에러
* 삭제의 경우 트랜잭션 내에서 유효성 검사를 하는 부분이 없어 try...catch를 통해 에러 던짐 (롤백)

2) Controller에서 AuthGuard 잘못된 사용
* AuthGuard 이렇게만 적어서 서버 시작 시 오류..
* AuthGuard('jwt') 로 바꿔주었음 !
```

</details>


# 🗒️ Code Convention

<details>
<summary> Code Convention </summary>

* 변수명 : `camelCase`
* 클래스명 : `PascalCase` 
* Prettier

```json
{
  "printWidth": 120,
  "tabWidth": 2,
  "useTabs": false,
  "semi": true,
  "singleQuote": false,
  "bracketSpacing": true,
  "trailingComma": "none"
}

```
</details>    
        
<details>   
<summary> DB Convention </summary>
  
* Table 명 : `소문자 복수형`
* DB Column명 : `snake_case`

</details>
<br><br><br>



## 환경변수

`.env` 파일 생성 후 아래 내용 입력

```
SERVER_PORT= 서버 포트번호 (default: 3000)

DB_HOST= DB 엔드포인트 주소
DB_PORT= DB 포트번호 (default:3306)
DB_USERNAME= 사용자 명
DB_PASSWORD= 비밀번호
DB_NAME= DB 이름
DB_SYNC= DB table 동기화 여부 (default: true)
PASSWORD_HASH_ROUNDS= 로그인 비밀번호 해시 생성 강도 (default: 10)
JWT_SECRET= JWT 생성 및 검증 키
PROD_APPKEY= 한국투자 OpenAPI 인증 앱키
PROD_APPSECRET= 한국투자 OpenAPI 인증 앱시크릿키

PUBLIC_ACCESS_KEY= 공공데이터 OpenAPI 인증키

NODE_MAIL_ID = 구글 이메일 전송할 유저
NODE_MAIL_PW = 구글 앱 비밀번호
GMAIL_OAUTH_USER=  구글 API CLIENT AUTH
GMAIL_OAUTH_CLIENT_ID=  구글 API CLIENT ID
GAMIL_OAUTH_CLIENT_SECRET=  구글 API CLIENT SERCRET
NAVER_CLIENT_ID = 네이버 애플리케이션 API CLIENT ID
NAVER_CLIENT_SECRET = 네이버 애플리케이션 API CLIENT SECRET

SLACK_ALARM_URI_SCHEDULE = 슬랙 웹 훅 URL

KAKAO_CLIENT_ID= kakao 애플리케이션 API CLIENT ID
KAKAO_CLIENT_SECRET =  kakao 애플리케이션 API CLIENT SECRET

REDIS_HOST= 레디스 클라우드 주소
REDIS_PORT= 레디스 클라우드 포트번호
REDIS_PASSWORD= 레디스 클라우드 비밀번호
```

## 실행 방법

```sh
npm install
npm run start:dev
```

## 설계 문서

- ERD: https://dbdiagram.io/d/Final_Project_HappyMoney-658a371b89dea6279988f566

- 와이어프레임: https://www.figma.com/file/g1xNcU7RORoY56gcK8QJnz/Final_Project_Happy_Money?type=design&node-id=0-1&mode=design&t=ohgAuc10sJl9k2Yf-0

## Swagger 접속 주소

/api-docs

## 참고 자료

- Nest.js 공식 문서: https://docs.nestjs.com
- TypeORM 공식 문서: https://typeorm.io
- Joi: https://www.npmjs.com/package/joi
- Class Validator: https://www.npmjs.com/package/class-validator
- Validator: https://www.npmjs.com/package/validator
- Passport 공식 문서: https://www.passportjs.org/docs
